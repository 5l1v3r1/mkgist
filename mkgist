#!/usr/bin/env python3
"""
Small utility for making anonymous gists from command line
"""

import os
import json
import argparse
import requests

BASE_DIR = os.getcwd()
ENDPOINT = "https://api.github.com/gists"


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Utility for making anonymous gists")
    parser.add_argument("filename", help="Name of file to make into gist")
    parser.add_argument("-d", "--description", help="description for gist")
    args = parser.parse_args()

    request_data = { "public": True }
    if args.description:
        request_data["description"] = args.description
    request_data["files"] = { args.filename: { "content": None } }
    with open("{}/{}".format(BASE_DIR, args.filename), 'r') as content_file:
        request_data["files"][args.filename]["content"] = content_file.read()

    r = requests.post(ENDPOINT, data=json.dumps(request_data))

    try:
        as_json = r.json()
        if 'html_url' in as_json:
            print(as_json['html_url'])
        else:
            print(as_json['message'])
    except:
        print("An error occured")
